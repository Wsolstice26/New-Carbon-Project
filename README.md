# Carbon-Emission-Super-Resolution v3.0

**å¼±ç›‘ç£ç¢³æ’æ”¾è¶…åˆ†è¾¨ç‡é‡å»ºæ¡†æ¶ï¼ˆWeakly-Supervised Carbon Emission Downscalingï¼‰**

---

## ğŸ“Œ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æå‡ºäº†ä¸€å¥— **é¢å‘ç¢³æ’æ”¾æ …æ ¼æ•°æ®çš„å¼±ç›‘ç£è¶…åˆ†è¾¨ç‡é‡å»ºæ¡†æ¶ï¼ˆv3.0ï¼‰**ï¼Œç”¨äºå°† **1 km åˆ†è¾¨ç‡çš„å¹´åº¦ç¢³æ’æ”¾æ€»é‡æ•°æ®**ï¼Œåœ¨ **æ€»é‡å®ˆæ’çš„ç‰©ç†çº¦æŸä¸‹**ï¼Œä¸‹æ¨è‡³ **100 m é«˜åˆ†è¾¨ç‡æ ¼ç½‘**ã€‚

ä¸ä¼ ç»Ÿâ€œå¼ºç›‘ç£åƒç´ å¯¹é½â€çš„è¶…åˆ†è¾¨ç‡æ–¹æ³•ä¸åŒï¼Œæœ¬æ¡†æ¶ï¼š

* **ä¸ä¾èµ–çœŸå®çš„ 100 m ç¢³æ’æ”¾æ ‡ç­¾**
* ä»…ä½¿ç”¨ **1 km æ€»é‡çº¦æŸ + å¤šæºè¾…åŠ©å› å­**
* é€šè¿‡ **ç‰©ç†ä¸€è‡´æ€§ + åˆ†å¸ƒçº¦æŸ + åŠ æƒå¼±ç›‘ç£æŸå¤±** å®ç°ç¨³å®šã€å¯è§£é‡Šçš„é™å°ºåº¦ç»“æœ

> ğŸ¯ ç›®æ ‡åº”ç”¨ï¼š
> åŸå¸‚/åŒºåŸŸå°ºåº¦ç¢³æ’æ”¾ç²¾ç»†åŒ–åˆ¶å›¾ã€ç©ºé—´å¼‚è´¨æ€§åˆ†æã€æ”¿ç­–è¯„ä¼°ä¸ç¢³ä¸­å’Œç ”ç©¶ã€‚

---

## ğŸ§  æ ¸å¿ƒæ€æƒ³ï¼ˆv3.0ï¼‰

### 1ï¸âƒ£ å¼±ç›‘ç£è€Œéå¼ºç›‘ç£

* åŸå§‹ç¢³æ’æ”¾æ•°æ®ï¼š**1 km ç½‘æ ¼æ€»é‡**
* ä¸å­˜åœ¨çœŸå®çš„ 100 m åƒç´ çº§æ ‡ç­¾
* æœ¬æ–¹æ³•ä»…è¦æ±‚ï¼š

  * **å—çº§ï¼ˆ1 kmï¼‰æ€»é‡ä¸€è‡´**
  * **ç©ºé—´åˆ†å¸ƒåˆç†**

---

### 2ï¸âƒ£ ç‰©ç†çº¦æŸä¼˜å…ˆï¼ˆPhysics-Guidedï¼‰

é€šè¿‡ **Water-Fillingï¼ˆå•çº¯å½¢æŠ•å½±ï¼‰ç‰©ç†çº¦æŸå±‚**ï¼Œä¸¥æ ¼ä¿è¯ï¼š

* âœ… éè´Ÿæ€§ï¼ˆNon-negativityï¼‰
* âœ… æ€»é‡å®ˆæ’ï¼ˆBlock-wise Mass Conservationï¼‰
* âœ… æ•°å€¼ç¨³å®šï¼ˆæ—  NaN / çˆ†ç‚¸ï¼‰

æ”¯æŒ **è®­ç»ƒ / æ¨ç†é˜¶æ®µä¸åŒçº¦æŸå°ºåº¦**ï¼š

| é˜¶æ®µ | çº¦æŸå°ºåº¦                |
| -- | ------------------- |
| è®­ç»ƒ | å…¨å±€ / å¤§å°ºåº¦ï¼ˆå¦‚ 120Ã—120ï¼‰ |
| æ¨ç† | 1 kmï¼ˆ10Ã—10ï¼‰         |

---

### 3ï¸âƒ£ é¢å‘æç«¯ç¨€ç–åˆ†å¸ƒçš„å¼±ç›‘ç£æŸå¤±ï¼ˆv3.0 æ ¸å¿ƒï¼‰

ç¢³æ’æ”¾å…·æœ‰å…¸å‹ç‰¹å¾ï¼š

* **å¤§é‡ 0 å€¼ï¼ˆèƒŒæ™¯ï¼‰**
* **æå°‘æ•°é«˜æ’æ”¾â€œå°¾éƒ¨åƒç´ â€**

è‹¥ç›´æ¥ç”¨æ™®é€š MAE / L1ï¼Œä¼šè¢« 0 å€¼ä¸¥é‡ç¨€é‡Šã€‚

#### ğŸ‘‰ æœ¬é¡¹ç›®é‡‡ç”¨ **åŒå±‚åŠ æƒ Pixel Loss**ï¼š

##### ğŸ”¹ å®è§‚å±‚ï¼ˆMacroï¼‰

* æ ¹æ® **å…¨å±€ 0 / é 0 æ¯”ä¾‹**
* ä½¿ç”¨ `log(Nz / Nnz)` æå‡é 0 åŒºåŸŸæƒé‡

##### ğŸ”¹ å¾®è§‚å±‚ï¼ˆMicroï¼‰

* åœ¨é 0 åŒºåŸŸå†…éƒ¨
* åŸºäº `log1p(y)` + **log åŸŸå˜å¼‚ç³»æ•° CV**
* è‡ªåŠ¨æ”¾å¤§é«˜æ’æ”¾åƒç´ ï¼ˆå·¥ä¸šã€èƒ½æºå¯†é›†åŒºï¼‰

âœ” æœ€ç»ˆé‡‡ç”¨ **å½’ä¸€åŒ–åŠ æƒæŸå¤±**ï¼Œé¿å…æ¢¯åº¦çˆ†ç‚¸æˆ–ç¨€é‡Šã€‚

---

## ğŸ§© æ¨¡å‹ç»“æ„æ¦‚è§ˆ

**DSTCarbonFormerï¼ˆ3D æ—¶åºæ¨¡å‹ï¼‰**

ä¸»è¦æ¨¡å—åŒ…æ‹¬ï¼š

* å¤šå°ºåº¦æ·±åº¦å¯åˆ†ç¦» 3D å·ç§¯ï¼ˆROCm å‹å¥½ï¼‰
* SFTï¼ˆSpatial Feature Transformï¼‰è¾…åŠ©å¼•å¯¼
* MoEï¼ˆMixture of Expertsï¼‰ç©ºé—´åˆ†å·¥
* é«˜æ•ˆå…¨å±€ä¸Šä¸‹æ–‡æ³¨æ„åŠ›
* Mamba-like ä½åˆ†è¾¨ç‡æ—¶åºå»ºæ¨¡
* ç‰©ç†çº¦æŸå±‚ï¼ˆå¯å¼€ / å¯å…³ï¼‰

è¾“å…¥è¾“å‡ºå½¢å¼ï¼š

```text
è¾“å…¥ï¼š
  Aux  : [B, 9, T, 120, 120]  å¤šæºè¾…åŠ©æ•°æ®
  Main : [B, 1, T, 120, 120]  1km æ€»é‡é€€åŒ–è¾“å…¥ï¼ˆlog åŸŸï¼‰

è¾“å‡ºï¼š
  Pred_raw         : æœªçº¦æŸé¢„æµ‹ï¼ˆlog åŸŸï¼‰
  Pred_constrained : ç‰©ç†çº¦æŸåé¢„æµ‹ï¼ˆlog åŸŸï¼‰
```

---

## ğŸ“Š è®­ç»ƒç›®æ ‡ä¸éªŒè¯æŒ‡æ ‡

### ğŸ”¥ ä¸»éªŒè¯æŒ‡æ ‡ï¼ˆå”¯ä¸€ç”¨äº Early Stop / Best Modelï¼‰

* **Nonzero-MAE**

  > åªåœ¨çœŸå®æ’æ”¾åŒºåŸŸè¯„ä¼°è¯¯å·®ï¼Œé¿å… 0 å€¼ä¸»å¯¼

### ğŸ“ˆ è¾…åŠ©åˆ†ææŒ‡æ ‡

* Balanced MAEï¼ˆ0 / é 0 å„å  50%ï¼‰
* Top-1% Nonzero MAEï¼ˆæç«¯é«˜æ’æ”¾ï¼‰
* Top-5% Nonzero MAE

> Top-k é˜ˆå€¼ **è‡ªé€‚åº”**ï¼ˆæŒ‰åˆ†ä½æ•°ï¼‰ï¼Œè€Œéå›ºå®šæ•°å€¼ã€‚

---

## ğŸ’¾ Checkpoint ä¸æ–­ç‚¹ç»­è®­æœºåˆ¶

æœ¬é¡¹ç›®é‡‡ç”¨ **å¤šçº§ã€å®‰å…¨ã€å¯å›æº¯çš„ä¿å­˜ç­–ç•¥**ï¼š

| æ–‡ä»¶å                   | ä½œç”¨                         |
| --------------------- | -------------------------- |
| `autosave_latest.pth` | å½“å‰æ­£åœ¨è®­ç»ƒçš„è‡ªåŠ¨ä¿å­˜                |
| `autosave_step_*.pth` | æ¯ N step è½®è½¬ä¿å­˜ï¼ˆå¯ Ctrl+Z å›æ»šï¼‰ |
| `epoch_010.pth`       | æ¯ 10 ä¸ª epoch çš„æ°¸ä¹…å¿«ç…§         |
| `best_model.pth`      | **Nonzero-MAE æœ€ä¼˜æ¨¡å‹**       |
| `latest.pth`          | æ¯ epoch ç»“æŸçš„æœ€æ–°çŠ¶æ€            |

âœ” æ”¯æŒ **è‡ªåŠ¨ / äº¤äº’å¼æ–­ç‚¹ç»­è®­**
âœ” æ”¯æŒ **step çº§ + epoch çº§ åŒé‡å®¹ç¾**

---

## ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

```text
Carbon-Emission-Super-Resolution/
â”‚
â”œâ”€ data/
â”‚   â””â”€ Train_Data_Yearly_120/     # å¹´åº¦è®­ç»ƒæ•°æ®
â”‚
â”œâ”€ models/
â”‚   â”œâ”€ network.py                 # DSTCarbonFormer ä¸»æ¨¡å‹
â”‚   â”œâ”€ losses.py                  # v3.0 å¼±ç›‘ç£æŸå¤±
â”‚   â”œâ”€ blocks.py                  # åŸºç¡€æ¨¡å—ï¼ˆMoE / SFT / Physicsï¼‰
â”‚
â”œâ”€ data/
â”‚   â””â”€ dataset.py                 # DualStreamDatasetï¼ˆå«å…¨å±€ç»Ÿè®¡ï¼‰
â”‚
â”œâ”€ config.py                      # å®éªŒé…ç½®ä¸è·¯å¾„ç®¡ç†
â”œâ”€ train.py                       # è®­ç»ƒä¸»å…¥å£ï¼ˆæ”¯æŒæ–­ç‚¹ï¼‰
â”‚
â”œâ”€ Checkpoints/
â”‚   â””â”€ Run_xxx/                   # å®éªŒç»“æœ
â”‚
â””â”€ README.md
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
conda activate your_env

# 2. å¯åŠ¨è®­ç»ƒ
python train.py
```

é¦–æ¬¡è®­ç»ƒä¼šè‡ªåŠ¨ï¼š

* è®¡ç®—å…¨å±€ `Nz/Nnz`ã€`CV_log`
* å†™å…¥å®éªŒç›®å½•
* ç”Ÿæˆå®Œæ•´ checkpoint ä½“ç³»

---

## ğŸ“Œ ç‰ˆæœ¬è¯´æ˜

### v3.0ï¼ˆå½“å‰ï¼‰

* âœ… å¼±ç›‘ç£ Pixel Lossï¼ˆå®è§‚ + å¾®è§‚ï¼‰
* âœ… å…¨å±€ç»Ÿè®¡è‡ªåŠ¨è®¡ç®—ï¼ˆDataset å†…ï¼‰
* âœ… ç‰©ç†ä¸€è‡´æ€§ Water-Filling
* âœ… Nonzero-MAE ä½œä¸ºå”¯ä¸€ä¸»æŒ‡æ ‡
* âœ… å·¥ç¨‹çº§ checkpoint ä½“ç³»
* âœ… ROCm / AMD GPU å‹å¥½

---

